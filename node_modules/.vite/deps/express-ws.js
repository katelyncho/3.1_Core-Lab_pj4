import {
  require_express
} from "./chunk-P7MLGCHC.js";
import {
  __commonJS
} from "./chunk-VUNV25KB.js";

// browser-external:http
var require_http = __commonJS({
  "browser-external:http"(exports, module) {
    module.exports = Object.create(new Proxy({}, {
      get(_, key) {
        if (key !== "__esModule" && key !== "__proto__" && key !== "constructor" && key !== "splice") {
          console.warn(`Module "http" has been externalized for browser compatibility. Cannot access "http.${key}" in client code. See https://vite.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`);
        }
      }
    }));
  }
});

// node_modules/ws/browser.js
var require_browser = __commonJS({
  "node_modules/ws/browser.js"(exports, module) {
    "use strict";
    module.exports = function() {
      throw new Error(
        "ws does not work in the browser. Browser clients must use the native WebSocket object"
      );
    };
  }
});

// node_modules/express-ws/lib/trailing-slash.js
var require_trailing_slash = __commonJS({
  "node_modules/express-ws/lib/trailing-slash.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    exports.default = addTrailingSlash;
    function addTrailingSlash(string) {
      var suffixed = string;
      if (suffixed.charAt(suffixed.length - 1) !== "/") {
        suffixed = suffixed + "/";
      }
      return suffixed;
    }
  }
});

// node_modules/express-ws/lib/websocket-url.js
var require_websocket_url = __commonJS({
  "node_modules/express-ws/lib/websocket-url.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    var _slicedToArray = /* @__PURE__ */ (function() {
      function sliceIterator(arr, i) {
        var _arr = [];
        var _n = true;
        var _d = false;
        var _e = void 0;
        try {
          for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
            _arr.push(_s.value);
            if (i && _arr.length === i) break;
          }
        } catch (err) {
          _d = true;
          _e = err;
        } finally {
          try {
            if (!_n && _i["return"]) _i["return"]();
          } finally {
            if (_d) throw _e;
          }
        }
        return _arr;
      }
      return function(arr, i) {
        if (Array.isArray(arr)) {
          return arr;
        } else if (Symbol.iterator in Object(arr)) {
          return sliceIterator(arr, i);
        } else {
          throw new TypeError("Invalid attempt to destructure non-iterable instance");
        }
      };
    })();
    exports.default = websocketUrl;
    var _trailingSlash = require_trailing_slash();
    var _trailingSlash2 = _interopRequireDefault(_trailingSlash);
    function _interopRequireDefault(obj) {
      return obj && obj.__esModule ? obj : { default: obj };
    }
    function websocketUrl(url) {
      if (url.indexOf("?") !== -1) {
        var _url$split = url.split("?"), _url$split2 = _slicedToArray(_url$split, 2), baseUrl = _url$split2[0], query = _url$split2[1];
        return (0, _trailingSlash2.default)(baseUrl) + ".websocket?" + query;
      }
      return (0, _trailingSlash2.default)(url) + ".websocket";
    }
  }
});

// node_modules/express-ws/lib/wrap-middleware.js
var require_wrap_middleware = __commonJS({
  "node_modules/express-ws/lib/wrap-middleware.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    exports.default = wrapMiddleware;
    function wrapMiddleware(middleware) {
      return function(req, res, next) {
        if (req.ws !== null && req.ws !== void 0) {
          req.wsHandled = true;
          try {
            middleware(req.ws, req, next);
          } catch (err) {
            next(err);
          }
        } else {
          next();
        }
      };
    }
  }
});

// node_modules/express-ws/lib/add-ws-method.js
var require_add_ws_method = __commonJS({
  "node_modules/express-ws/lib/add-ws-method.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    exports.default = addWsMethod;
    var _wrapMiddleware = require_wrap_middleware();
    var _wrapMiddleware2 = _interopRequireDefault(_wrapMiddleware);
    var _websocketUrl = require_websocket_url();
    var _websocketUrl2 = _interopRequireDefault(_websocketUrl);
    function _interopRequireDefault(obj) {
      return obj && obj.__esModule ? obj : { default: obj };
    }
    function _toConsumableArray(arr) {
      if (Array.isArray(arr)) {
        for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
          arr2[i] = arr[i];
        }
        return arr2;
      } else {
        return Array.from(arr);
      }
    }
    function addWsMethod(target) {
      if (target.ws === null || target.ws === void 0) {
        target.ws = function addWsRoute(route) {
          for (var _len = arguments.length, middlewares = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
            middlewares[_key - 1] = arguments[_key];
          }
          var wrappedMiddlewares = middlewares.map(_wrapMiddleware2.default);
          var wsRoute = (0, _websocketUrl2.default)(route);
          this.get.apply(this, _toConsumableArray([wsRoute].concat(wrappedMiddlewares)));
          return this;
        };
      }
    }
  }
});

// node_modules/express-ws/lib/index.js
var require_lib = __commonJS({
  "node_modules/express-ws/lib/index.js"(exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
    exports.default = expressWs;
    var _http = require_http();
    var _http2 = _interopRequireDefault(_http);
    var _express = require_express();
    var _express2 = _interopRequireDefault(_express);
    var _ws = require_browser();
    var _ws2 = _interopRequireDefault(_ws);
    var _websocketUrl = require_websocket_url();
    var _websocketUrl2 = _interopRequireDefault(_websocketUrl);
    var _addWsMethod = require_add_ws_method();
    var _addWsMethod2 = _interopRequireDefault(_addWsMethod);
    function _interopRequireDefault(obj) {
      return obj && obj.__esModule ? obj : { default: obj };
    }
    function expressWs(app, httpServer) {
      var options = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : {};
      var server = httpServer;
      if (server === null || server === void 0) {
        server = _http2.default.createServer(app);
        app.listen = function serverListen() {
          var _server;
          return (_server = server).listen.apply(_server, arguments);
        };
      }
      (0, _addWsMethod2.default)(app);
      if (!options.leaveRouterUntouched) {
        (0, _addWsMethod2.default)(_express2.default.Router);
      }
      var wsOptions = options.wsOptions || {};
      wsOptions.server = server;
      var wsServer = new _ws2.default.Server(wsOptions);
      wsServer.on("connection", function(socket, request) {
        if ("upgradeReq" in socket) {
          request = socket.upgradeReq;
        }
        request.ws = socket;
        request.wsHandled = false;
        request.url = (0, _websocketUrl2.default)(request.url);
        var dummyResponse = new _http2.default.ServerResponse(request);
        dummyResponse.writeHead = function writeHead(statusCode) {
          if (statusCode > 200) {
            dummyResponse._header = "";
            socket.close();
          }
        };
        app.handle(request, dummyResponse, function() {
          if (!request.wsHandled) {
            socket.close();
          }
        });
      });
      return {
        app,
        getWss: function getWss() {
          return wsServer;
        },
        applyTo: function applyTo(router) {
          (0, _addWsMethod2.default)(router);
        }
      };
    }
  }
});

// node_modules/express-ws/index.js
var require_express_ws = __commonJS({
  "node_modules/express-ws/index.js"(exports, module) {
    module.exports = require_lib().default;
  }
});
export default require_express_ws();
//# sourceMappingURL=express-ws.js.map
